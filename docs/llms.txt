# femtograd

Automatic differentiation for statistical computing in R.

`femtograd` provides reverse-mode AD (backpropagation) for first-order
gradients and forward-over-reverse AD for Hessian computation. Designed
for **pedagogy and modern statistics** rather than large-scale ML.

## Features

- **Reverse-mode AD**: Efficient gradient computation via
  backpropagation
- **Forward-over-reverse AD**: Second-order derivatives (Hessians) for
  Newton-Raphson and Fisher information
- **Log-likelihood functions**: Exponential family distributions
  (normal, exponential, Poisson, binomial, gamma, beta, negative
  binomial, logistic, Bernoulli)
- **MLE optimization**: Gradient ascent/descent, Newton-Raphson, BFGS,
  L-BFGS with line search
- **Statistical inference**: Standard errors, variance-covariance
  matrices, confidence intervals, Wald tests
- **Numerical stability**: logsumexp, softmax, safe log/division,
  overflow protection

## Installation

``` r
# Install from GitHub
devtools::install_github("queelius/femtograd")
```

## Quick Start

``` r
library(femtograd)

# Generate exponential data
set.seed(42)
x <- rexp(100, rate = 2)

# Define log-likelihood
loglik <- function(p) loglik_exponential(p[[1]], x)

# Find MLE with standard errors
result <- find_mle(loglik, list(val(1)), method = "newton")
result$estimate  # MLE
result$se        # Standard errors
```

## Core Concepts

### Computational Graph

Create differentiable values with
[`val()`](https://queelius.github.io/femtograd/reference/val.md):

``` r
x <- val(3)
y <- val(4)
z <- x^2 + x*y  # z = 9 + 12 = 21

backward(z)
grad(x)  # dz/dx = 2x + y = 10
grad(y)  # dz/dy = x = 3
```

### Supported Operations

Arithmetic: `+`, `-`, `*`, `/`, `^`

Transcendental: `log`, `exp`, `sqrt`, `sin`, `cos`, `tanh`, `lgamma`,
`digamma`, `log1p`

Activations: `sigmoid`, `relu`, `softplus`, `logit`

Stability: `logsumexp`, `softmax`, `log_safe`, `div_safe`, `exp_safe`,
`sigmoid_stable`, `log_sigmoid`

### Hessian Computation

``` r
f <- function(p) {
  x <- p[[1]]
  y <- p[[2]]
  x^2 + x*y + y^2
}

H <- hessian(f, list(val(1), val(2)))
# Returns 2x2 Hessian matrix
```

## Maximum Likelihood Estimation

### Built-in Distributions

``` r
# Normal distribution
loglik <- function(p) loglik_normal(p[[1]], p[[2]], data)

# Poisson distribution
loglik <- function(p) loglik_poisson(p[[1]], data)

# Gamma distribution
loglik <- function(p) loglik_gamma(p[[1]], p[[2]], data)
```

### Optimization Methods

``` r
# Gradient ascent
result <- gradient_ascent(loglik, params, lr = 0.01, max_iter = 1000)

# Newton-Raphson (uses Hessian)
result <- newton_raphson(loglik, params, max_iter = 50)

# BFGS quasi-Newton
result <- bfgs(loglik, params, maximize = TRUE)

# L-BFGS (memory efficient)
result <- lbfgs(loglik, params, m = 10, maximize = TRUE)

# Full MLE with inference
result <- find_mle(loglik, params, method = "newton")
```

### Statistical Inference

``` r
result <- find_mle(loglik, params)

# Standard errors from Fisher information
result$se

# Variance-covariance matrix
result$vcov

# Confidence intervals
confint_mle(result, level = 0.95)

# Wald test
wald_test(result, null_values = c(0, 1))
```

## Example: Normal MLE

``` r
set.seed(123)
true_mu <- 5
true_sigma <- 2
x <- rnorm(100, true_mu, true_sigma)

loglik <- function(p) loglik_normal(p[[1]], p[[2]], x)

# Find MLE
result <- find_mle(loglik, list(val(mean(x)), val(sd(x))))

cat("MLE mu:", result$estimate[1], "SE:", result$se[1], "\n")
cat("MLE sigma:", result$estimate[2], "SE:", result$se[2], "\n")

# 95% confidence intervals
confint_mle(result)
```

## Design Philosophy

- **Pedagogy over performance**: Code prioritizes clarity for teaching
  AD concepts
- **Statistics focus**: Built for MLE, Hessians, and inference rather
  than deep learning
- **Composable foundation**: Designed as a building block for other
  statistical packages

## Acknowledgments

Inspired by Karpathyâ€™s
[micrograd](https://github.com/karpathy/micrograd).

## License

GPL-3

# Package index

## All functions

- [`abs(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/abs.value.md)
  : Absolute value for value objects

- [`backward()`](https://queelius.github.io/femtograd/reference/backward.md)
  :

  Generic function for the Backward pass for automatic differentiation
  (finds the gradient of every sub-node in the computational graph with
  respect to `e`). In other words, it is responsible for computing the
  gradient with respect to `e`.

- [`backward(`*`<default>`*`)`](https://queelius.github.io/femtograd/reference/backward.default.md)
  : Default implementation does not propagate gradients. For instance,
  if we have a constant, then the partial of the constant is not
  meaningful.

- [`backward(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/backward.value.md)
  : Backward pass for value objects

- [`bfgs()`](https://queelius.github.io/femtograd/reference/bfgs.md) :
  BFGS quasi-Newton optimizer

- [`bootstrap`](https://queelius.github.io/femtograd/reference/bootstrap.md)
  : Bootstrap Inference

- [`bootstrap_fit()`](https://queelius.github.io/femtograd/reference/bootstrap_fit.md)
  : Bootstrap standard errors and confidence intervals

- [`bounded()`](https://queelius.github.io/femtograd/reference/bounded.md)
  : Transform to bounded interval

- [`check_convergence()`](https://queelius.github.io/femtograd/reference/check_convergence.md)
  : Check convergence diagnostics

- [`check_hessian()`](https://queelius.github.io/femtograd/reference/check_hessian.md)
  : Check Hessian properties

- [`confint(`*`<bootstrap_result>`*`)`](https://queelius.github.io/femtograd/reference/confint.bootstrap_result.md)
  : Confidence intervals from bootstrap

- [`confint_mle()`](https://queelius.github.io/femtograd/reference/confint_mle.md)
  : Compute confidence intervals from MLE results

- [`confint_profile()`](https://queelius.github.io/femtograd/reference/confint_profile.md)
  : Profile confidence intervals

- [`cos(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/cos.value.md)
  : Cosine function for value objects

- [`` `data<-`() ``](https://queelius.github.io/femtograd/reference/data-set.md)
  : Set the data of a value object

- [`x`](https://queelius.github.io/femtograd/reference/data.md) :
  Retrieve the data stored by an object.

- [`data(`*`<default>`*`)`](https://queelius.github.io/femtograd/reference/data.default.md)
  : Default implementation for retrieving the data from a differentiable
  object

- [`data(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/data.value.md)
  : Retrieve the data matrix from a value object

- [`diagnostics()`](https://queelius.github.io/femtograd/reference/diagnostics.md)
  : Model Diagnostics

- [`digamma(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/digamma.value.md)
  : Digamma (psi) function for value objects

- [`distributions`](https://queelius.github.io/femtograd/reference/distributions.md)
  : Log-likelihood functions for exponential family distributions

- [`div_safe()`](https://queelius.github.io/femtograd/reference/div_safe.md)
  : Safe division (handles division by zero)

- [`dof()`](https://queelius.github.io/femtograd/reference/dof.md) :
  Extract degrees of freedom from hypothesis test

- [`` `-`( ``*`<value>`*`)`](https://queelius.github.io/femtograd/reference/dot-value.md)
  : Subtraction for value objects

- [`dual`](https://queelius.github.io/femtograd/reference/dual.md) :
  dual R6 class for forward-mode automatic differentiation

- [`dual_num()`](https://queelius.github.io/femtograd/reference/dual_num.md)
  : Create a dual number

- [`exp(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/exp.value.md)
  : Exponential function for value objects

- [`exp_safe()`](https://queelius.github.io/femtograd/reference/exp_safe.md)
  : Stable exp function (with overflow protection)

- [`femtofit()`](https://queelius.github.io/femtograd/reference/femtofit.md)
  [`coef(`*`<femtofit>`*`)`](https://queelius.github.io/femtograd/reference/femtofit.md)
  [`vcov(`*`<femtofit>`*`)`](https://queelius.github.io/femtograd/reference/femtofit.md)
  [`confint(`*`<femtofit>`*`)`](https://queelius.github.io/femtograd/reference/femtofit.md)
  [`logLik(`*`<femtofit>`*`)`](https://queelius.github.io/femtograd/reference/femtofit.md)
  [`nobs(`*`<femtofit>`*`)`](https://queelius.github.io/femtograd/reference/femtofit.md)
  [`print(`*`<femtofit>`*`)`](https://queelius.github.io/femtograd/reference/femtofit.md)
  [`summary(`*`<femtofit>`*`)`](https://queelius.github.io/femtograd/reference/femtofit.md)
  [`print(`*`<summary.femtofit>`*`)`](https://queelius.github.io/femtograd/reference/femtofit.md)
  : Constructor for femtofit objects

- [`find_mle()`](https://queelius.github.io/femtograd/reference/find_mle.md)
  : Find MLE with standard errors

- [`fisher_information()`](https://queelius.github.io/femtograd/reference/fisher_information.md)
  : Compute observed Fisher information matrix

- [`fisher_scoring()`](https://queelius.github.io/femtograd/reference/fisher_scoring.md)
  : Fisher scoring optimizer

- [`fit()`](https://queelius.github.io/femtograd/reference/fit.md) : Fit
  a model via maximum likelihood

- [`fitting`](https://queelius.github.io/femtograd/reference/fitting.md)
  : Statistical model fitting with automatic differentiation

- [`grad()`](https://queelius.github.io/femtograd/reference/grad.md) :

  Gradient of `x` with respect to `e` in `backward(e)`, e.g., dx/de.
  (applies the chain rule)

- [`grad(`*`<default>`*`)`](https://queelius.github.io/femtograd/reference/grad.default.md)
  : Default gradient is zero matrix

- [`grad(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/grad.value.md)
  :

  Gradient of a `value` object `x` with respect to `e` in `backward(e)`,
  e.g., dx/de. (applies the chain rule)

- [`gradient()`](https://queelius.github.io/femtograd/reference/gradient.md)
  : Compute gradient as a numeric vector

- [`gradient_ascent()`](https://queelius.github.io/femtograd/reference/gradient_ascent.md)
  : Gradient ascent/descent optimizer

- [`gradient_descent()`](https://queelius.github.io/femtograd/reference/gradient_descent.md)
  : Gradient descent (minimize)

- [`hessian()`](https://queelius.github.io/femtograd/reference/hessian.md)
  : Compute Hessian matrix via forward-over-reverse automatic
  differentiation

- [`hypothesis_tests`](https://queelius.github.io/femtograd/reference/hypothesis_tests.md)
  : Hypothesis Testing for Fitted Models

- [`inv_bounded()`](https://queelius.github.io/femtograd/reference/inv_bounded.md)
  : Inverse of bounded transform

- [`inv_positive()`](https://queelius.github.io/femtograd/reference/inv_positive.md)
  : Inverse of positive transform

- [`inv_probability()`](https://queelius.github.io/femtograd/reference/inv_probability.md)
  : Inverse of probability transform

- [`inverse_transforms`](https://queelius.github.io/femtograd/reference/inverse_transforms.md)
  : Inverse transforms for recovering original scale

- [`is_dual()`](https://queelius.github.io/femtograd/reference/is_dual.md)
  : Check if object is a dual number

- [`is_significant_at()`](https://queelius.github.io/femtograd/reference/is_significant_at.md)
  : Check if test is significant at given level

- [`is_value()`](https://queelius.github.io/femtograd/reference/is_value.md)
  : Check if an object is of class value

- [`lbfgs()`](https://queelius.github.io/femtograd/reference/lbfgs.md) :
  L-BFGS optimizer (limited memory BFGS)

- [`lgamma(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/lgamma.value.md)
  : Log-gamma function for value objects

- [`line_search()`](https://queelius.github.io/femtograd/reference/line_search.md)
  : Backtracking line search (Armijo condition)

- [`log(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/log.value.md)
  : Natural logarithm for value objects

- [`log1p(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/log1p.value.md)
  : Log(1+x) for value objects

- [`log1p_safe()`](https://queelius.github.io/femtograd/reference/log1p_safe.md)
  : Log1p with underflow protection

- [`log_safe()`](https://queelius.github.io/femtograd/reference/log_safe.md)
  : Safe logarithm (handles zeros)

- [`log_sigmoid()`](https://queelius.github.io/femtograd/reference/log_sigmoid.md)
  : Log-sigmoid (numerically stable)

- [`logit()`](https://queelius.github.io/femtograd/reference/logit.md) :
  Logit function for value objects

- [`loglik_bernoulli()`](https://queelius.github.io/femtograd/reference/loglik_bernoulli.md)
  : Bernoulli distribution log-likelihood

- [`loglik_beta()`](https://queelius.github.io/femtograd/reference/loglik_beta.md)
  : Beta distribution log-likelihood

- [`loglik_binomial()`](https://queelius.github.io/femtograd/reference/loglik_binomial.md)
  : Binomial distribution log-likelihood

- [`loglik_exponential()`](https://queelius.github.io/femtograd/reference/loglik_exponential.md)
  : Exponential distribution log-likelihood

- [`loglik_gamma()`](https://queelius.github.io/femtograd/reference/loglik_gamma.md)
  : Gamma distribution log-likelihood

- [`loglik_logistic()`](https://queelius.github.io/femtograd/reference/loglik_logistic.md)
  : Logistic regression log-likelihood (binary)

- [`loglik_negbinom()`](https://queelius.github.io/femtograd/reference/loglik_negbinom.md)
  : Negative binomial log-likelihood

- [`loglik_normal()`](https://queelius.github.io/femtograd/reference/loglik_normal.md)
  : Normal (Gaussian) log-likelihood

- [`loglik_pareto()`](https://queelius.github.io/femtograd/reference/loglik_pareto.md)
  : Pareto distribution log-likelihood

- [`loglik_poisson()`](https://queelius.github.io/femtograd/reference/loglik_poisson.md)
  : Poisson distribution log-likelihood

- [`loglik_weibull()`](https://queelius.github.io/femtograd/reference/loglik_weibull.md)
  : Weibull distribution log-likelihood

- [`logsumexp()`](https://queelius.github.io/femtograd/reference/logsumexp.md)
  : Log-Sum-Exp (numerically stable)

- [`lower_bounded()`](https://queelius.github.io/femtograd/reference/lower_bounded.md)
  : Transform to lower-bounded interval

- [`lrt()`](https://queelius.github.io/femtograd/reference/lrt.md) :
  Likelihood Ratio Test

- [`mean(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/mean.value.md)
  : Mean for value objects

- [`newton_raphson()`](https://queelius.github.io/femtograd/reference/newton_raphson.md)
  : Newton-Raphson optimizer

- [`observed_info()`](https://queelius.github.io/femtograd/reference/observed_info.md)
  : Observed Fisher information matrix

- [`optimization`](https://queelius.github.io/femtograd/reference/optimization.md)
  : Optimization routines for maximum likelihood estimation

- [`plot(`*`<profile_likelihood>`*`)`](https://queelius.github.io/femtograd/reference/plot.profile_likelihood.md)
  : Plot profile likelihood

- [`` `+`( ``*`<value>`*`)`](https://queelius.github.io/femtograd/reference/plus-.value.md)
  : Addition for value objects

- [`positive()`](https://queelius.github.io/femtograd/reference/positive.md)
  : Transform to positive values

- [`` `^`( ``*`<value>`*`)`](https://queelius.github.io/femtograd/reference/pow-.value.md)
  : Power operation for value objects.

- [`primal()`](https://queelius.github.io/femtograd/reference/primal.md)
  : Extract primal from dual or return value unchanged

- [`print(`*`<bootstrap_result>`*`)`](https://queelius.github.io/femtograd/reference/print.bootstrap_result.md)
  : Print method for bootstrap results

- [`print(`*`<hessian_check>`*`)`](https://queelius.github.io/femtograd/reference/print.hessian_check.md)
  [`print(`*`<convergence_check>`*`)`](https://queelius.github.io/femtograd/reference/print.hessian_check.md)
  [`print(`*`<model_diagnostics>`*`)`](https://queelius.github.io/femtograd/reference/print.hessian_check.md)
  : Print methods for diagnostic objects

- [`print(`*`<likelihood_ratio_test>`*`)`](https://queelius.github.io/femtograd/reference/print.likelihood_ratio_test.md)
  : Print method for likelihood ratio test

- [`print(`*`<profile_likelihood>`*`)`](https://queelius.github.io/femtograd/reference/print.profile_likelihood.md)
  : Print method for profile likelihood

- [`print(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/print.value.md)
  : Print value object and its computational graph

- [`print(`*`<wald_test>`*`)`](https://queelius.github.io/femtograd/reference/print.wald_test.md)
  : Print method for Wald test

- [`probability()`](https://queelius.github.io/femtograd/reference/probability.md)
  : Transform to probability values

- [`profile_likelihood`](https://queelius.github.io/femtograd/reference/profile_likelihood.md)
  : Profile Likelihood

- [`profile_loglik()`](https://queelius.github.io/femtograd/reference/profile_loglik.md)
  : Compute profile likelihood for a parameter

- [`pval()`](https://queelius.github.io/femtograd/reference/pval.md) :
  Extract p-value from hypothesis test

- [`relu()`](https://queelius.github.io/femtograd/reference/relu.md) :
  ReLU activation function for value objects

- [`se()`](https://queelius.github.io/femtograd/reference/se.md) :
  Standard errors from a fitted model

- [`se_reliable()`](https://queelius.github.io/femtograd/reference/se_reliable.md)
  : Check if standard errors are reliable

- [`sigmoid()`](https://queelius.github.io/femtograd/reference/sigmoid.md)
  : Sigmoid activation function for value objects

- [`sigmoid_stable()`](https://queelius.github.io/femtograd/reference/sigmoid_stable.md)
  : Stable sigmoid function

- [`sin(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/sin.value.md)
  : Sine function for value objects

- [`` `/`( ``*`<value>`*`)`](https://queelius.github.io/femtograd/reference/slash-.value.md)
  : Division for value objects

- [`softmax()`](https://queelius.github.io/femtograd/reference/softmax.md)
  : Softmax function (numerically stable)

- [`softplus()`](https://queelius.github.io/femtograd/reference/softplus.md)
  : Softplus function for value objects

- [`sqrt(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/sqrt.value.md)
  : Square root for value objects

- [`stability`](https://queelius.github.io/femtograd/reference/stability.md)
  : Numerical stability utilities for automatic differentiation

- [`std_errors()`](https://queelius.github.io/femtograd/reference/std_errors.md)
  : Compute standard errors from Hessian

- [`sum(`*`<dual>`*`)`](https://queelius.github.io/femtograd/reference/sum.dual.md)
  : Sum for dual numbers

- [`sum(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/sum.value.md)
  : Summation for value objects

- [`summary(`*`<bootstrap_result>`*`)`](https://queelius.github.io/femtograd/reference/summary.bootstrap_result.md)
  : Summary for bootstrap results

- [`tangent()`](https://queelius.github.io/femtograd/reference/tangent.md)
  : Extract tangent from dual or return 0

- [`tanh(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/tanh.value.md)
  : Hyperbolic tangent for value objects

- [`test_stat()`](https://queelius.github.io/femtograd/reference/test_stat.md)
  : Extract test statistic from hypothesis test

- [`` `*`( ``*`<value>`*`)`](https://queelius.github.io/femtograd/reference/times-.value.md)
  : Multiplication for value objects

- [`transforms`](https://queelius.github.io/femtograd/reference/transforms.md)
  : Parameter Transformation Helpers

- [`trigamma(`*`<value>`*`)`](https://queelius.github.io/femtograd/reference/trigamma.value.md)
  : Trigamma function for value objects

- [`upper_bounded()`](https://queelius.github.io/femtograd/reference/upper_bounded.md)
  : Transform to upper-bounded interval

- [`val()`](https://queelius.github.io/femtograd/reference/val.md) :

  `value` object constructor

- [`value`](https://queelius.github.io/femtograd/reference/value.md) :
  value R6 class

- [`vcov_matrix()`](https://queelius.github.io/femtograd/reference/vcov_matrix.md)
  : Compute variance-covariance matrix from Hessian

- [`wald_test()`](https://queelius.github.io/femtograd/reference/wald_test.md)
  : Wald Test for Model Parameters

